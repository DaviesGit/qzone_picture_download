!function(){"use strict";var win,doc,list,waitInterval,index=0,photos=[],fileArray=[];waitInterval=prompt("Please enter checker wait interval! (ms)"),waitInterval=isNaN(waitInterval)||""===waitInterval?5e3:+waitInterval;var makeDownloadUrl=function(e){return e=e.replace(/&t=\d+/,"")},waituntil=function(checker,callback,delay){delay||(delay=100),checker()?callback():setTimeout(function(){waituntil(checker,callback,delay)},delay)},beginDownload=function(){var fileName,data,blob,elem;confirm("Whether download fileArray!")&&(fileName=slide.photos[0].ownerName+"("+slide.photos[0].ownerUin+")_fileArray.json",data=JSON.stringify(fileArray),blob=new Blob([data],{type:"text/plain"}),(elem=window.document.createElement("a")).href=window.URL.createObjectURL(blob),elem.download=fileName,elem.click()),confirm("Whether download all picture!\ntotal items:"+fileArray.length)&&function(fileArray){var interval=prompt("Please enter file download interval! (ms)");interval=isNaN(interval)||""===interval?2e3:+interval;for(var i=0;i<fileArray.length;++i){var file=fileArray[i];setTimeout(function(file){return function(){var fileName,url,elem;fileName=file.fileName,url=file.url,(elem=window.document.createElement("a")).href=url,elem.download=fileName,elem.click()}}(file),interval*i)}}(fileArray)};"0"===jQuery("#QM_Profile_Photo_Cnt").text()&&alert("this QZone not have photo!");var photoButton=jQuery("#QM_Profile_Photo_A")[0];if(photoButton)photoButton.click();else if(!confirm("Not find photo button! whether continune?"))return;waituntil(function(){var iframe=document.getElementById("tphoto");return!!iframe&&(win=iframe.contentWindow||iframe,doc=win.document,!!(list=jQuery(".js-album-list-ul>li",doc)).length)},function(){var download_loop=function(){if(index>=list.length){window.fileArray=fileArray;var downloadButton=jQuery(".top-nav>.nav-list:last>div>a").unbind("click");return downloadButton.html("Download"),void downloadButton.click(beginDownload)}var album=list[index],img=jQuery(".js-cover-img",album);if(-1!=img.attr("onload").indexOf("http://qzonestyle.gtimg.cn/aoi/img/photo/logic/pwd.png")||-1!=img.attr("onload").indexOf("http://qzonestyle.gtimg.cn/aoi/img/photo/logic/pic-none.png"))return++index,void download_loop();img.click(),waituntil(function(){if(doc=win.document,!jQuery(".list.j-pl-photolist-ul",doc).length){var ele=jQuery("#js-viewer-container");return!(!ele||!ele.length)&&"none"!=ele.css("display")}return!0},function(){var callback,interval1;doc=win.document,callback=function(){doc=win.document,++index,jQuery(".c-tx2.js-select",doc)[0].click(),list=null,waituntil(function(){return doc=win.document,!!(list=jQuery(".js-album-list-ul>li",doc)).length},function(){download_loop()},waitInterval)},interval1=setInterval(function(){var random=Math.floor(10*Math.random());win.document.getElementsByClassName("j-pl-photoitem-imgctn")[random].click()},waitInterval),waituntil(function(){var ele=jQuery("#js-viewer-container");return!(!ele||!ele.length)&&"none"!=ele.css("display")},function(){clearInterval(interval1);var interval2=setInterval(function(){jQuery("#js-thumb-next>a")[0].click()},waitInterval);waituntil(function(){if(!window.slide||!slide.picTotal||!slide.photos)return!1;for(var i=0;i<slide.photos.length;++i){for(var whetherAdd=!0,ii=0;ii<photos.length;++ii)if(photos[ii].picKey===slide.photos[i].picKey){whetherAdd=!1;break}whetherAdd&&photos.push(slide.photos[i])}return photos.length===slide.picTotal},function(){clearInterval(interval2),jQuery(".photo_layer_close>a").click();for(var i=0;i<photos.length;++i)photo=photos[i],nameFragment=fileName=void 0,nameFragment=(nameFragment=photo.ownerName.replace(/_/gi,"-")+"_"+photo.topicName.replace(/_/gi,"-")+"_"+photo.name.replace(/_/gi,"-")+"_"+photo.picKey.replace(/_/gi,"-")).replace(/\./gi,"&#046"),1===photo.raw_upload?(fileName=nameFragment+"_raw",fileArray.push({fileName:fileName,url:makeDownloadUrl(photo.raw)})):photo.origin?(fileName=nameFragment+"_origin",fileArray.push({fileName:fileName,url:makeDownloadUrl(photo.origin)})):photo.downloadUrl?(fileName=nameFragment+"_downloadUrl",fileArray.push({fileName:fileName,url:makeDownloadUrl(photo.downloadUrl)})):(fileName=nameFragment+"_url",fileArray.push({fileName:fileName,url:makeDownloadUrl(photo.url)}));var photo,fileName,nameFragment;photos=[],callback()},waitInterval)},waitInterval)},waitInterval)};download_loop()},waitInterval)}();